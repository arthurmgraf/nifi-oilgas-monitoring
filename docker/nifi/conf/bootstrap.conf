# =============================================================================
# NiFi Oil & Gas Monitoring Platform - bootstrap.conf
# =============================================================================
# JVM tuning for NiFi 2.8.0 running inside Docker.
# Heap sizes are parameterised via environment variables so that dev, staging,
# and production profiles can override without rebuilding the image.
# =============================================================================

# --- Java command (use bundled JVM) ---
java=java

# --- JVM Memory ---
java.arg.2=-Xms${NIFI_HEAP_INIT:-1g}
java.arg.3=-Xmx${NIFI_HEAP_MAX:-2g}

# --- JVM GC Settings (G1GC, suitable for 2-4 GB heaps) ---
java.arg.4=-XX:+UseG1GC
java.arg.5=-XX:G1HeapRegionSize=16m
java.arg.6=-XX:+ParallelRefProcEnabled
java.arg.7=-XX:MaxGCPauseMillis=200

# --- JVM GC Logging ---
java.arg.8=-Xlog:gc*:file=/opt/nifi/nifi-current/logs/gc.log:time,uptime,level,tags:filecount=5,filesize=10m

# --- JVM Metaspace ---
java.arg.9=-XX:MetaspaceSize=256m
java.arg.10=-XX:MaxMetaspaceSize=512m

# --- JVM Misc ---
java.arg.11=-XX:+HeapDumpOnOutOfMemoryError
java.arg.12=-XX:HeapDumpPath=/opt/nifi/nifi-current/logs
java.arg.13=-Djava.security.egd=file:/dev/urandom
java.arg.14=-Dsun.net.http.allowRestrictedHeaders=true

# --- NiFi Process Settings ---
run.as=
preserve.environment=true

# --- Graceful shutdown (seconds) ---
graceful.shutdown.seconds=20

# --- Notification services ---
notification.max.attempts=5

# --- Sensitive key (set via environment variable, never hardcode) ---
# This key encrypts sensitive properties in flow.json.gz.
nifi.bootstrap.sensitive.key=

# --- NiFi Bootstrap Listener ---
nifi.bootstrap.listen.port=0

# --- Master Key Provider ---
# When set, NiFi will use this for encrypting sensitive configuration values.
# In production, use an external provider (HashiCorp Vault, AWS KMS, etc.).
# nifi.bootstrap.protection.scheme=

# --- JVM DNS cache TTL (useful for Docker service discovery) ---
java.arg.15=-Dsun.net.inetaddr.ttl=30
java.arg.16=-Dsun.net.inetaddr.negative.ttl=10
